<div class="main-content">

  <div class="report-toolbar">
    <span class="report-title"> <i class="k-icon k-i-check"></i> Projects</span>

    <div class="right-section ms-auto">
      <button kendoButton icon="refresh" themeColor="primary" (click)="refresh()">Refresh</button>
      <button kendoButton icon="plus" themeColor="secondary" class="ms-1" routerLink="new">New</button>
    </div>
  </div>

  <kendo-expansionpanel [expanded]="true" class="mt-2">
    <ng-template kendoExpansionPanelTitleDirective>
      <div class="header-content d-flex align-items-center">
        <kendo-icon name="filter"></kendo-icon>
        <span class="ms-1"> Filters</span>
      </div>
    </ng-template>

    <div class="row">

      <div class="col-md-3">
        <kendo-label class="k-form fw-semibold" text="Country" [for]="cboCountry"></kendo-label>
        <kendo-dropdownlist #cboCountry valueField="Id" textField="Text" [defaultItem]="cboDefaultItem" [data]="countries$ | async"
          [(ngModel)]="selectedCountry"> </kendo-dropdownlist>
      </div>

      <div class="col-md-3">
        <kendo-label class="k-form fw-semibold" text="Name" [for]="txtName"></kendo-label>
        <input #txtName kendoTextBox [(ngModel)]="name" class="w-100" />
      </div>

    </div>

  </kendo-expansionpanel>

  <div class="alert alert-danger alert-dismissible fade show mt-2" *ngIf="projectsError$ | async as errorMessage" role="alert">
    <span>{{errorMessage}}</span>
    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
  </div>
  
  <div id="grdProjects">
    <kendo-grid  #grid [data]="projects$ | async" [pageable]="true" class="mt-2"  [loading]="(loading$ | async)!"
        [pageSize]="15" [resizable]="true" (dataStateChange)="onDataStateChange($event)">

      <kendo-grid-column [width]="200" field="Code" title="Code"></kendo-grid-column>
      <kendo-grid-column [width]="200" field="Name" title="Name"></kendo-grid-column>
      <kendo-grid-column [width]="200" field="WTGUnits" title="WTG units" class="text-end"> </kendo-grid-column>
      <kendo-grid-column [width]="200" field="ContractStageName" title="Contract stage"></kendo-grid-column>
      <kendo-grid-column [width]="200" field="ContractScopeName" title="Contract scope"></kendo-grid-column>
      <kendo-grid-column [width]="300" field="ProductLineName" title="Product line" class="text-nowrap"></kendo-grid-column>
      <kendo-grid-column [width]="200" field="PlanningHorizon" title="Planning horizon"></kendo-grid-column>
      <kendo-grid-column [width]="200" field="ProjectState" title="Project state"></kendo-grid-column>
      <kendo-grid-column [width]="200" field="Validity" title="Validity dates"></kendo-grid-column>

      <div *kendoGridDetailTemplate="let dataItem; showIf: showDetailGrid">
        <kendo-grid #gridDetail [data]="dataItem.Logs" [pageable]="true" [pageSize]="15" [rowClass]="rowClassCallback">
          <kendo-grid-column [width]="200" field="Code" title="Code"></kendo-grid-column>
          <kendo-grid-column [width]="200" field="Name" title="Name"></kendo-grid-column>
          <kendo-grid-column [width]="115" field="WTGUnits" title="WTG units" class="text-end"> </kendo-grid-column>
          <kendo-grid-column [width]="200" field="ContractStageName" title="Contract stage"></kendo-grid-column>
          <kendo-grid-column [width]="200" field="ContractScopeName" title="Contract scope"></kendo-grid-column>
          <kendo-grid-column [width]="300" field="ProductLineName" title="Product line" class="text-nowrap"></kendo-grid-column>
          <kendo-grid-column [width]="200" field="PlanningHorizon" title="Planning horizon"></kendo-grid-column>
          <kendo-grid-column [width]="200" field="ProjectState" title="Project state"></kendo-grid-column>
          <kendo-grid-column [width]="200" field="Validity" title="Validity dates"></kendo-grid-column>
        </kendo-grid>
      </div>

      <ng-template kendoGridLoadingTemplate>
        <div class="k-loading-color"></div>
        <div class="loading-container">
          <kendo-loader type="converging-spinner" size="large"></kendo-loader>
        </div>
      </ng-template>
      
    </kendo-grid>
  </div>

</div>